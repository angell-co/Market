<form sprig
      s-method="post"
      s-action="users/save-user"
      method="post"
      class="mt-6"
>
    {% set user = user ?? currentUser %}

    {{ hiddenInput('userId', user.id) }}

    <div x-data="{
             existingEmail: '{{ user.email }}',
             newEmail: '{{ user.email }}',
         }"
         class="shadow sm:rounded-md sm:overflow-hidden"
    >
        <div class="bg-white py-6 px-4 sm:p-6">
            <div>
                <h2 class="text-lg leading-6 font-medium text-gray-900">Update your details</h2>
                <p class="mt-1 text-sm text-gray-500">You can change your name or update the email address that you sign in with.</p>
            </div>

            <div class="mt-6 grid grid-cols-4 gap-6">
                <div class="col-span-4 sm:col-span-2">
                    <label for="firstName" class="block text-sm font-medium text-gray-700">First name</label>
                    <input type="text"
                           id="firstName"
                           name="firstName"
                           value="{{ user.firstName }}"
                           class="mt-1 block w-full shadow-sm focus:ring-action-500 focus:border-action-500 sm:text-sm border-gray-300 rounded-md"
                    >
                </div>

                <div class="col-span-4 sm:col-span-2">
                    <label for="lastName" class="block text-sm font-medium text-gray-700">Last name</label>
                    <input type="text"
                           id="lastName"
                           name="lastName"
                           value="{{ user.lastName }}"
                           class="mt-1 block w-full shadow-sm focus:ring-action-500 focus:border-action-500 sm:text-sm border-gray-300 rounded-md"
                    >
                </div>

                <div class="col-span-4 sm:col-span-2">
                    <label for="email" class="block text-sm font-medium text-gray-700">Email address</label>
                    <template x-if="newEmail !== existingEmail">
                        <input x-ref="emailInput"
                               type="hidden"
                               name="email"
                        >
                    </template>
                    <input type="email"
                           id="email"
                           x-model="newEmail"
                           x-on:keyup="$refs.emailInput.value = newEmail"
                           value="{{ user.email }}"
                           class="mt-1 block w-full shadow-sm focus:ring-action-500 focus:border-action-500 sm:text-sm border-gray-300 rounded-md"
                    >
                </div>

                <div x-show="newEmail !== existingEmail"
                     x-cloak
                     class="col-span-4 sm:col-span-2"
                >
                    <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password"
                           id="password"
                           name="password"
                           class="mt-1 block w-full shadow-sm focus:ring-action-500 focus:border-action-500 sm:text-sm border-gray-300 rounded-md"
                    >
                </div>

            </div>
        </div>
        <div class="px-4 py-3 bg-gray-50 text-right sm:px-6">
            <button type="submit"
                    class="px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-action-600 hover:bg-action-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-action-500"
            >
                Save
            </button>
        </div>
    </div>
</form>
